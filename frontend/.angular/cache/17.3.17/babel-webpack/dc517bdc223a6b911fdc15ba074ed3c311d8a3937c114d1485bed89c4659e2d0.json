{"ast":null,"code":"import { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.messagesSubject = new Subject();\n    this.messages$ = this.messagesSubject.asObservable();\n    this.reconnectInterval = 5000;\n  }\n  connect(url = 'ws://localhost:8080/ws/messages') {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      console.log('WebSocket already connected');\n      return;\n    }\n    try {\n      this.socket = new WebSocket(url);\n      this.socket.onopen = () => {\n        console.log('WebSocket connected successfully');\n        if (this.reconnectTimer) {\n          clearTimeout(this.reconnectTimer);\n          this.reconnectTimer = null;\n        }\n      };\n      this.socket.onmessage = event => {\n        try {\n          const message = JSON.parse(event.data);\n          console.log('Received message:', message);\n          this.messagesSubject.next(message);\n        } catch (error) {\n          console.error('Error parsing message:', error);\n        }\n      };\n      this.socket.onerror = error => {\n        console.error('WebSocket error:', error);\n      };\n      this.socket.onclose = () => {\n        console.log('WebSocket disconnected. Attempting to reconnect...');\n        this.reconnect(url);\n      };\n    } catch (error) {\n      console.error('Error creating WebSocket:', error);\n      this.reconnect(url);\n    }\n  }\n  reconnect(url) {\n    if (this.reconnectTimer) {\n      return;\n    }\n    this.reconnectTimer = setTimeout(() => {\n      console.log('Reconnecting to WebSocket...');\n      this.reconnectTimer = null;\n      this.connect(url);\n    }, this.reconnectInterval);\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n  isConnected() {\n    return this.socket?.readyState === WebSocket.OPEN;\n  }\n  static {\n    this.ɵfac = function WebSocketService_Factory(t) {\n      return new (t || WebSocketService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: WebSocketService,\n      factory: WebSocketService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["Subject","WebSocketService","constructor","socket","messagesSubject","messages$","asObservable","reconnectInterval","connect","url","readyState","WebSocket","OPEN","console","log","onopen","reconnectTimer","clearTimeout","onmessage","event","message","JSON","parse","data","next","error","onerror","onclose","reconnect","setTimeout","disconnect","close","isConnected","factory","ɵfac","providedIn"],"sources":["/home/mahmoud-alarnaout/IdeaProjects/apacheCamel-ActiveMQ/frontend/src/app/websocket.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Subject, Observable } from 'rxjs';\n\nexport interface MessageResponse {\n  correlationId: string;\n  data: {\n    correlationId: string;\n    content: string;\n    status: string;\n    timestamp?: string;\n  };\n  timestamp: number;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WebSocketService {\n  private socket: WebSocket | null = null;\n  private messagesSubject = new Subject<MessageResponse>();\n  public messages$: Observable<MessageResponse> = this.messagesSubject.asObservable();\n  private reconnectInterval = 5000;\n  private reconnectTimer: any;\n\n  constructor() {}\n\n  connect(url: string = 'ws://localhost:8080/ws/messages'): void {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      console.log('WebSocket already connected');\n      return;\n    }\n\n    try {\n      this.socket = new WebSocket(url);\n\n      this.socket.onopen = () => {\n        console.log('WebSocket connected successfully');\n        if (this.reconnectTimer) {\n          clearTimeout(this.reconnectTimer);\n          this.reconnectTimer = null;\n        }\n      };\n\n      this.socket.onmessage = (event) => {\n        try {\n          const message: MessageResponse = JSON.parse(event.data);\n          console.log('Received message:', message);\n          this.messagesSubject.next(message);\n        } catch (error) {\n          console.error('Error parsing message:', error);\n        }\n      };\n\n      this.socket.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n\n      this.socket.onclose = () => {\n        console.log('WebSocket disconnected. Attempting to reconnect...');\n        this.reconnect(url);\n      };\n    } catch (error) {\n      console.error('Error creating WebSocket:', error);\n      this.reconnect(url);\n    }\n  }\n\n  private reconnect(url: string): void {\n    if (this.reconnectTimer) {\n      return;\n    }\n\n    this.reconnectTimer = setTimeout(() => {\n      console.log('Reconnecting to WebSocket...');\n      this.reconnectTimer = null;\n      this.connect(url);\n    }, this.reconnectInterval);\n  }\n\n  disconnect(): void {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n\n  isConnected(): boolean {\n    return this.socket?.readyState === WebSocket.OPEN;\n  }\n}\n"],"mappings":"AACA,SAASA,OAAO,QAAoB,MAAM;;AAgB1C,OAAM,MAAOC,gBAAgB;EAO3BC,YAAA;IANQ,KAAAC,MAAM,GAAqB,IAAI;IAC/B,KAAAC,eAAe,GAAG,IAAIJ,OAAO,EAAmB;IACjD,KAAAK,SAAS,GAAgC,IAAI,CAACD,eAAe,CAACE,YAAY,EAAE;IAC3E,KAAAC,iBAAiB,GAAG,IAAI;EAGjB;EAEfC,OAAOA,CAACC,GAAA,GAAc,iCAAiC;IACrD,IAAI,IAAI,CAACN,MAAM,EAAEO,UAAU,KAAKC,SAAS,CAACC,IAAI,EAAE;MAC9CC,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;MAC1C;;IAGF,IAAI;MACF,IAAI,CAACX,MAAM,GAAG,IAAIQ,SAAS,CAACF,GAAG,CAAC;MAEhC,IAAI,CAACN,MAAM,CAACY,MAAM,GAAG,MAAK;QACxBF,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;QAC/C,IAAI,IAAI,CAACE,cAAc,EAAE;UACvBC,YAAY,CAAC,IAAI,CAACD,cAAc,CAAC;UACjC,IAAI,CAACA,cAAc,GAAG,IAAI;;MAE9B,CAAC;MAED,IAAI,CAACb,MAAM,CAACe,SAAS,GAAIC,KAAK,IAAI;QAChC,IAAI;UACF,MAAMC,OAAO,GAAoBC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;UACvDV,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEM,OAAO,CAAC;UACzC,IAAI,CAAChB,eAAe,CAACoB,IAAI,CAACJ,OAAO,CAAC;SACnC,CAAC,OAAOK,KAAK,EAAE;UACdZ,OAAO,CAACY,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;;MAElD,CAAC;MAED,IAAI,CAACtB,MAAM,CAACuB,OAAO,GAAID,KAAK,IAAI;QAC9BZ,OAAO,CAACY,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;MAC1C,CAAC;MAED,IAAI,CAACtB,MAAM,CAACwB,OAAO,GAAG,MAAK;QACzBd,OAAO,CAACC,GAAG,CAAC,oDAAoD,CAAC;QACjE,IAAI,CAACc,SAAS,CAACnB,GAAG,CAAC;MACrB,CAAC;KACF,CAAC,OAAOgB,KAAK,EAAE;MACdZ,OAAO,CAACY,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,IAAI,CAACG,SAAS,CAACnB,GAAG,CAAC;;EAEvB;EAEQmB,SAASA,CAACnB,GAAW;IAC3B,IAAI,IAAI,CAACO,cAAc,EAAE;MACvB;;IAGF,IAAI,CAACA,cAAc,GAAGa,UAAU,CAAC,MAAK;MACpChB,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC;MAC3C,IAAI,CAACE,cAAc,GAAG,IAAI;MAC1B,IAAI,CAACR,OAAO,CAACC,GAAG,CAAC;IACnB,CAAC,EAAE,IAAI,CAACF,iBAAiB,CAAC;EAC5B;EAEAuB,UAAUA,CAAA;IACR,IAAI,IAAI,CAAC3B,MAAM,EAAE;MACf,IAAI,CAACA,MAAM,CAAC4B,KAAK,EAAE;MACnB,IAAI,CAAC5B,MAAM,GAAG,IAAI;;IAEpB,IAAI,IAAI,CAACa,cAAc,EAAE;MACvBC,YAAY,CAAC,IAAI,CAACD,cAAc,CAAC;MACjC,IAAI,CAACA,cAAc,GAAG,IAAI;;EAE9B;EAEAgB,WAAWA,CAAA;IACT,OAAO,IAAI,CAAC7B,MAAM,EAAEO,UAAU,KAAKC,SAAS,CAACC,IAAI;EACnD;;;uBA3EWX,gBAAgB;IAAA;EAAA;;;aAAhBA,gBAAgB;MAAAgC,OAAA,EAAhBhC,gBAAgB,CAAAiC,IAAA;MAAAC,UAAA,EAFf;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}